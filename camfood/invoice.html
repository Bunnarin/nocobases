<script>
    fetch(`http://localhost:13000/api/product:list`, { headers: { 'Authorization': 'Bearer {{$nToken}}', 'X-App': 'camfood' } })
        .then(response => response.json())
        .then(({data}) => data.forEach(({id, name}) => {
            const cell = document.getElementById(id);
            if (cell) cell.textContent = name;
        }))
        .then(() => window.print());
</script>

<div>
    <!-- Header Section (Invoice Title & ID/Date) -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-bottom: 25px; border-bottom: 1px solid #e0e0e0;">
        <tr>
            <td style="font-size: 28px; font-weight: bold; color: #333333; padding-bottom: 15px;">Camfood</td>
            <td align="right" style="font-size: 14px; color: #666666; padding-bottom: 15px;">
                #{{$nRecord.id}}<br>
                ថ្ងៃសរសេរ: {{dateFormat $nRecord.createdAt "YYYY-MM-DD"}}<br>
                ថ្ងៃកែ: {{dateFormat $nRecord.updatedAt "YYYY-MM-DD"}}
            </td>
        </tr>
    </table>

    <!-- Items Table -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-collapse: collapse; margin-bottom: 30px;">
        <thead>
            <tr style="background-color: #f0f0f0;">
                <th style="padding: 10px; text-align: left; font-size: 14px; font-weight: bold; color: #555555;">ទំនិញ</th>
                <th style="padding: 10px; text-align: left; font-size: 14px; font-weight: bold; color: #555555;">ចំនួន</th>
                <th style="padding: 10px; text-align: left; font-size: 14px; font-weight: bold; color: #555555;">តម្លៃ</th>
            </tr>
        </thead>
        <tbody>
            {{#each $nPopupRecord.invoice_items}}
            <tr style="border-top: 1px solid #eeeeee;">
                <td id="{{this.product_id}}" style="padding: 10px; font-size: 15px; color: #333333;">{{this.comment}}</td>
                <td style="padding: 10px; font-size: 15px; color: #333333;">{{this.amount}}</td>
                <td style="padding: 10px; font-size: 15px; color: #333333;">${{this.subtotal}}</td>
            </tr>
            {{/each}}
        </tbody>
        <tfoot>
            <tr style="border-top: 2px solid #333333; background-color: #f9f9f9;">
                <td colspan="2" align="right" style="padding: 15px 10px; font-size: 16px; font-weight: bold; color: #333333;">សរុប:</td>
                <td style="padding: 15px 10px; font-size: 16px; font-weight: bold; color: #000000;">${{$nRecord.total}}</td>
            </tr>
        </tfoot>
    </table>
    
    <!-- Grand Total and Signatures Section (3 columns) -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0" style="border-top: 1px solid #e0e0e0; padding-top: 20px;">
        <tr>
            <!-- Column 2: Seller Signature -->
            <td width="33.3%" style="vertical-align: top; padding-left: 15px; padding-right: 15px;">
                <p style="font-size: 16px; font-weight: bold; color: #555555; margin: 0 0 5px 0;">អ្នកលក់</p>
                <div style="border-bottom: 1px dashed #aaaaaa; height: 70px; margin-bottom: 5px;"></div>
                {{$nRecord.createdBy.nickname}}
            </td>

            <!-- Column 3: Buyer Signature -->
            <td width="33.3%" style="vertical-align: top; padding-left: 15px;">
                <p style="font-size: 16px; font-weight: bold; color: #555555; margin: 0 0 5px 0;">អ្នកទិញ</p>
                <div style="border-bottom: 1px dashed #aaaaaa; height: 70px; margin-bottom: 5px;"></div>
{{$nRecord.customer.name}}
            </td>
        </tr>
    </table>
</div>